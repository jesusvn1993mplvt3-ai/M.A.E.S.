<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cirineo PRO - Hub Central v4.2</title>
    
    <link rel="icon" href="https://raw.githubusercontent.com/jesusvn1993mplvt3-ai/CIRINEO/refs/heads/main/icon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { background-color: #0f172a; color: white; font-family: ui-sans-serif, system-ui; margin: 0; overflow: hidden; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .sidebar-item { transition: all 0.2s; border-radius: 1rem; }
        .sidebar-item.active { background: #3b82f6; color: white; shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.5); }
        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade { animation: fadeIn 0.3s ease-out forwards; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const firebaseConfig = {
            apiKey: "AIzaSyCngQL1pdqghv2vbjkPycT1Xf0C46f7jYs",
            authDomain: "cirineo-cec21.firebaseapp.com",
            projectId: "cirineo-cec21",
            storageBucket: "cirineo-cec21.firebasestorage.app",
            messagingSenderId: "620210618284",
            appId: "1:620210618284:web:482bab9bf74650fff18409"
        };

        if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const Icon = ({ name, size = 20, className = "" }) => {
            const ref = React.useRef(null);
            useEffect(() => {
                if (ref.current && lucide.icons[name]) {
                    ref.current.innerHTML = lucide.icons[name].toSvg({ width: size, height: size, 'stroke-width': 2.5 });
                }
            }, [name, size]);
            return <div ref={ref} className={`inline-block ${className}`} style={{ width: size, height: size }}></div>;
        };

        const App = () => {
            const [view, setView] = useState('dashboard');
            const [orders, setOrders] = useState([]);
            const [inventory, setInventory] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                const unsubOrders = db.collection('orders').orderBy('createdAt', 'desc').onSnapshot(snap => {
                    setOrders(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                    setLoading(false);
                }, err => console.error("Error órdenes:", err));

                const unsubInv = db.collection('inventory').onSnapshot(snap => {
                    setInventory(snap.docs.map(doc => ({ id: doc.id, ...doc.data() })));
                }, err => console.error("Error inventario:", err));

                return () => { unsubOrders(); unsubInv(); };
            }, []);

            const activeOrders = useMemo(() => orders.filter(o => o.status !== 'ARCHIVADO'), [orders]);
            const archivedOrders = useMemo(() => orders.filter(o => o.status === 'ARCHIVADO'), [orders]);

            return (
                <div className="flex h-screen w-full overflow-hidden">
                    {/* SIDEBAR */}
                    <aside className="w-20 lg:w-64 bg-slate-900 border-r border-slate-800 flex flex-col p-4 z-30">
                        <div className="flex items-center gap-3 px-2 mb-10">
                            <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-900/40">
                                <Icon name="Zap" className="text-white"/>
                            </div>
                            <span className="hidden lg:block font-black italic tracking-tighter text-xl text-white">CIRINEO</span>
                        </div>

                        <nav className="flex-grow space-y-2">
                            <button onClick={() => setView('dashboard')} className={`sidebar-item w-full flex items-center gap-4 p-4 font-bold ${view === 'dashboard' ? 'active' : 'text-slate-500 hover:bg-slate-800'}`}>
                                <Icon name="LayoutDashboard" />
                                <span className="hidden lg:block">Dashboard</span>
                            </button>
                            <button onClick={() => setView('inventory')} className={`sidebar-item w-full flex items-center gap-4 p-4 font-bold ${view === 'inventory' ? 'active' : 'text-slate-500 hover:bg-slate-800'}`}>
                                <Icon name="Package" />
                                <span className="hidden lg:block">Inventario</span>
                            </button>
                            <button onClick={() => setView('history')} className={`sidebar-item w-full flex items-center gap-4 p-4 font-bold ${view === 'history' ? 'active' : 'text-slate-500 hover:bg-slate-800'}`}>
                                <Icon name="Archive" />
                                <span className="hidden lg:block">Archivo</span>
                            </button>
                        </nav>
                        
                        <div className="mt-auto p-4 bg-slate-800/50 rounded-2xl hidden lg:block border border-slate-700">
                            <p className="text-[10px] font-black text-slate-500 uppercase">Cloud Sync</p>
                            <div className="flex items-center gap-2 mt-1">
                                <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
                                <span className="text-xs font-bold text-green-500">Conectado</span>
                            </div>
                        </div>
                    </aside>

                    {/* MAIN CONTENT */}
                    <main className="flex-grow relative flex flex-col bg-slate-950 overflow-hidden">
                        <div className="flex-grow overflow-y-auto custom-scroll p-6 lg:p-10 pb-32">
                            
                            {view === 'dashboard' && (
                                <div className="animate-fade space-y-8">
                                    <header className="flex justify-between items-end">
                                        <div>
                                            <h2 className="text-3xl lg:text-5xl font-black italic tracking-tighter">PRODUCCIÓN</h2>
                                            <p className="text-slate-500 font-bold text-sm uppercase tracking-widest mt-1">Monitoreo en tiempo real</p>
                                        </div>
                                        <a href="generador_pedidos.html" className="bg-white text-black px-6 py-3 rounded-2xl font-black flex items-center gap-2 hover:scale-105 transition-transform active:scale-95 shadow-xl">
                                            <Icon name="Plus" size={20}/> <span className="hidden sm:inline">NUEVO PEDIDO</span>
                                        </a>
                                    </header>

                                    <div className="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
                                        {activeOrders.map(o => {
                                            const bultosTotal = o.progreso?.length || 0;
                                            const bultosFin = o.progreso?.filter(p => p.finalizado)?.length || 0;
                                            const progresoPct = bultosTotal > 0 ? (bultosFin / bultosTotal) * 100 : 0;
                                            const isKit = o.subPiecesData?.length > 0;

                                            return (
                                                <div key={o.id} className="bg-slate-900 rounded-[2.5rem] p-6 border border-slate-800 shadow-sm hover:border-slate-700 transition-colors relative overflow-hidden">
                                                    {isKit && <div className="absolute top-0 right-0 bg-yellow-500 text-black text-[9px] font-black px-4 py-1 rounded-bl-xl">KIT</div>}
                                                    <div className="flex justify-between items-start mb-4">
                                                        <div>
                                                            <p className="text-[10px] font-black text-slate-500 uppercase tracking-widest">{o.cliente || 'Sin Cliente'}</p>
                                                            <h3 className="text-xl font-black uppercase text-white truncate max-w-[200px]">{o.codigo}</h3>
                                                        </div>
                                                        <div className="text-right">
                                                            <span className="text-[10px] font-bold text-blue-500 block">{o.partida}</span>
                                                            <span className="text-xs font-black text-slate-400">M-{o.maquina || '?'}</span>
                                                        </div>
                                                    </div>
                                                    <div className="space-y-2">
                                                        <div className="flex justify-between items-end text-[10px] font-black text-slate-500 uppercase">
                                                            <span>Progreso de bultos</span>
                                                            <span className="text-white">{bultosFin}/{bultosTotal}</span>
                                                        </div>
                                                        <div className="h-2 bg-slate-800 rounded-full overflow-hidden">
                                                            <div className="h-full bg-blue-600 transition-all duration-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]" style={{width: `${progresoPct}%`}}></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}

                            {view === 'inventory' && (
                                <div className="animate-fade space-y-8">
                                    <h2 className="text-3xl lg:text-5xl font-black italic tracking-tighter">INVENTARIO HILO</h2>
                                    <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                                        {inventory.map(item => (
                                            <div key={item.id} className="bg-slate-900 p-6 rounded-[2rem] border border-slate-800">
                                                <p className="text-[10px] font-black text-slate-500 uppercase">{item.tipo || 'Material'}</p>
                                                <h3 className="text-lg font-black text-white mb-2">{item.nombre}</h3>
                                                <div className="flex items-baseline gap-1">
                                                    <span className="text-3xl font-black text-blue-500">{item.cantidad}</span>
                                                    <span className="text-xs font-bold text-slate-500">KG</span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {view === 'history' && (
                                <div className="animate-fade space-y-4">
                                    <h2 className="text-3xl font-black italic mb-6 uppercase">Archivo de órdenes</h2>
                                    {archivedOrders.map(o => (
                                        <div key={o.id} className="bg-slate-900/50 p-4 rounded-3xl border border-slate-800 flex justify-between items-center opacity-60">
                                            <div>
                                                <div className="font-black text-white uppercase">{o.codigo}</div>
                                                <div className="text-[10px] font-bold text-slate-500">{o.cliente} • {o.partida}</div>
                                            </div>
                                            <div className="text-xs font-black text-slate-600 uppercase italic">Archivado</div>
                                        </div>
                                    ))}
                                </div>
                            )}

                        </div>

                        {/* BOTTOM ACCESOS RÁPIDOS */}
                        <div className="absolute bottom-6 left-1/2 -translate-x-1/2 w-full max-w-md px-4">
                            <div className="glass-panel p-2 rounded-[2.5rem] flex justify-around items-center shadow-2xl border border-white/10">
                                <a href="papeletas.html" className="flex flex-col items-center gap-1 p-3 hover:bg-white/5 rounded-2xl transition-all">
                                    <Icon name="Printer" className="text-blue-400"/>
                                    <span className="text-[9px] font-black uppercase">Papeletas</span>
                                </a>
                                <a href="post-tejido-check.html" className="flex flex-col items-center gap-1 p-3 hover:bg-white/5 rounded-2xl transition-all">
                                    <Icon name="ScanLine" className="text-green-400"/>
                                    <span className="text-[9px] font-black uppercase">Salida</span>
                                </a>
                                <div className="w-[1px] h-8 bg-slate-700"></div>
                                <button className="flex flex-col items-center gap-1 p-3 opacity-30 cursor-not-allowed">
                                    <Icon name="BarChart3" />
                                    <span className="text-[9px] font-black uppercase">Reportes</span>
                                </button>
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>